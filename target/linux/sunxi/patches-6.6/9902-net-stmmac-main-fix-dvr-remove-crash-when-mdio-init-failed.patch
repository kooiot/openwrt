--- a/drivers/net/ethernet/stmicro/stmmac/stmmac.h
+++ b/drivers/net/ethernet/stmicro/stmmac/stmmac.h
@@ -334,6 +334,9 @@ struct stmmac_priv {
 	/* XDP BPF Program */
 	unsigned long *af_xdp_zc_qps;
 	struct bpf_prog *xdp_prog;
+
+	/* For unregister_netdev crash */
+	int netdev_inited;
 };

 enum stmmac_state {
--- a/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
+++ b/drivers/net/ethernet/stmicro/stmmac/stmmac_main.c
@@ -7794,6 +7794,7 @@ int stmmac_dvr_probe(struct device *devi
 			__func__, ret);
 		goto error_netdev_register;
 	}
+	priv->netdev_inited = 1;

 #ifdef CONFIG_DEBUG_FS
 	stmmac_init_fs(ndev);
@@ -7844,8 +7845,10 @@ void stmmac_dvr_remove(struct device *de

 	stmmac_stop_all_dma(priv);
 	stmmac_mac_set(priv, priv->ioaddr, false);
-	netif_carrier_off(ndev);
-	unregister_netdev(ndev);
+	if (priv->netdev_inited) {
+		netif_carrier_off(ndev);
+		unregister_netdev(ndev);
+	}

 #ifdef CONFIG_DEBUG_FS
 	stmmac_exit_fs(ndev);
