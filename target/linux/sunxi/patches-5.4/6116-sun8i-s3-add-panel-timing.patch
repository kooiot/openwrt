From f74c54c65b3a472721629e1432a79d98e3894fa9 Mon Sep 17 00:00:00 2001
From: greedyhao <hao_kr@163.com>
Date: Wed, 15 Jan 2020 21:51:33 +0800
Subject: [PATCH 6116/6117] sun8i:s3:add panel timing

---
 .../boot/dts/sun8i-s3-lichee-zero-plus.dts    | 47 ++++++++++++++++---
 drivers/gpu/drm/panel/panel-simple.c          | 30 ++++++++++++
 2 files changed, 70 insertions(+), 7 deletions(-)

diff --git a/arch/arm/boot/dts/sun8i-s3-lichee-zero-plus.dts b/arch/arm/boot/dts/sun8i-s3-lichee-zero-plus.dts
index 0d41c5c66281..f4216ef17b23 100644
--- a/arch/arm/boot/dts/sun8i-s3-lichee-zero-plus.dts
+++ b/arch/arm/boot/dts/sun8i-s3-lichee-zero-plus.dts
@@ -61,7 +61,8 @@
 	panel: panel {
 		#address-cells = <1>;
 		#size-cells = <0>;
-		compatible = "urt,umsh-8596md-t", "simple-panel";
+		// compatible = "urt,umsh-8596md-t", "simple-panel";
+		compatible = "stx,st7701s-t", "simple-panel";
 
 		port@0 {
 			reg = <0>;
@@ -74,6 +75,39 @@
 				remote-endpoint = <&tcon0_out_lcd>;
 			};
 		};
+
+		// compatible = "panel-lvds";
+
+		// data-mapping = "jeida-18";
+		// width-mm = <54>;
+		// height-mm = <95>;
+
+		// panel-timing {
+		// 		clock-frequency = <33000000>;
+		// 		hactive = <360>;
+		// 		vactive = <640>;
+		// 		hfront-porch = <40>;
+		// 		hsync-len = <1>;
+		// 		hback-porch = <200>;
+		// 		vfront-porch = <12>;
+		// 		vsync-len = <1>;
+		// 		vback-porch = <30>;
+		// 		hsync-active = <0>;
+		// 		vsync-active = <0>;
+		// 		pixelclk-active = <0>;
+		// };
+
+		// port@0 {
+		// 	reg = <0>;
+		// 	backlight = <&backlight>;
+		// 	#address-cells = <1>;
+		// 	#size-cells = <0>;
+
+		// 	panel_input: endpoint@0 {
+		// 		reg = <0>;
+		// 		remote-endpoint = <&tcon0_out_lcd>;
+		// 	};
+		// };
 	};
 };
 
@@ -97,14 +131,13 @@
 &i2c0 {
 	status = "okay";
 
-	gt911: touchscreen@14 {
+	gt911: touchscreen@5d {
         compatible = "goodix,gt911";
-        reg = <0x14>;
+        reg = <0x5d>;
         interrupt-parent = <&pio>;
-        interrupts = <1 11 IRQ_TYPE_EDGE_FALLING>; /* (PB11) */
-        pinctrl-names = "default";
-        irq-gpios = <&pio 1 11 GPIO_ACTIVE_HIGH>; /* (PB11) */
-        reset-gpios = <&pio 4 9 GPIO_ACTIVE_HIGH>; /* RST (PE9) */
+        interrupts = <6 12 IRQ_TYPE_LEVEL_HIGH>; /* (PE18) */
+        irq-gpios = <&pio 6 12 GPIO_ACTIVE_HIGH>; /* (PE18) */
+        reset-gpios = <&pio 6 10 GPIO_ACTIVE_HIGH>; /* RST (PE17) */
         /* touchscreen-swapped-x-y */
     };
 
diff --git a/drivers/gpu/drm/panel/panel-simple.c b/drivers/gpu/drm/panel/panel-simple.c
index 5a93c4edf1e4..6a493b4e18cf 100644
--- a/drivers/gpu/drm/panel/panel-simple.c
+++ b/drivers/gpu/drm/panel/panel-simple.c
@@ -1335,6 +1335,33 @@ static const struct panel_desc giantplus_gpg482739qs5 = {
 	.bus_format = MEDIA_BUS_FMT_RGB888_1X24,
 };
 
+static const struct drm_display_mode sitronix_st7701s_mode = {
+	.clock = 33000,
+	.hdisplay = 360,
+	.hsync_start = 360 + 37,
+	.hsync_end = 360 + 37 + 1,
+	.htotal = 360 + 37 + 1 + 60,
+	.vdisplay = 640,
+	.vsync_start = 640 + 16,
+	.vsync_end = 640 + 16 + 96,
+	.vtotal = 640 + 16 + 96 + 48,
+	.vrefresh = 60,
+	// .flags = DRM_MODE_FLAG_NVSYNC | DRM_MODE_FLAG_NHSYNC,
+	// .flags = DISPLAY_FLAGS_HSYNC_HIGH | DISPLAY_FLAGS_VSYNC_HIGH |
+	// .flags = DISPLAY_FLAGS_HSYNC_LOW | DISPLAY_FLAGS_VSYNC_LOW,
+};
+
+static const struct panel_desc sitronix_st7701s = {
+	.modes = &sitronix_st7701s_mode,
+	.num_modes = 1,
+	.bpc = 6,
+	.size = {
+		.width = 54,
+		.height = 95,
+	},
+	.bus_format = MEDIA_BUS_FMT_RGB666_1X18,
+};
+
 static const struct display_timing hannstar_hsd070pww1_timing = {
 	.pixelclock = { 64300000, 71100000, 82000000 },
 	.hactive = { 1280, 1280, 1280 },
@@ -3038,6 +3065,9 @@ static const struct of_device_id platform_of_match[] = {
 	}, {
 		.compatible = "tpk,f10a-0102",
 		.data = &tpk_f10a_0102,
+	}, {
+		.compatible = "stx,st7701s-t",
+		.data = &sitronix_st7701s,
 	}, {
 		.compatible = "urt,umsh-8596md-t",
 		.data = &urt_umsh_8596md_parallel,
-- 
2.30.2

